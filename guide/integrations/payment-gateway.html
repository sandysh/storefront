<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Payment Gateway Integration | Vue Storefront</title>
    <meta name="description" content="Headless PWA for eCommerce">
    <link rel="icon" href="/vue-storefront/favicon.png">
    
    <link rel="preload" href="/vue-storefront/assets/css/0.styles.6ab44ad9.css" as="style"><link rel="preload" href="/vue-storefront/assets/js/app.cd989924.js" as="script"><link rel="preload" href="/vue-storefront/assets/js/44.5f33530b.js" as="script"><link rel="prefetch" href="/vue-storefront/assets/js/10.cd9cbebb.js"><link rel="prefetch" href="/vue-storefront/assets/js/11.1563466b.js"><link rel="prefetch" href="/vue-storefront/assets/js/12.3551c657.js"><link rel="prefetch" href="/vue-storefront/assets/js/13.030cdfc0.js"><link rel="prefetch" href="/vue-storefront/assets/js/14.9ddbe990.js"><link rel="prefetch" href="/vue-storefront/assets/js/15.42fb0c58.js"><link rel="prefetch" href="/vue-storefront/assets/js/16.13a72e91.js"><link rel="prefetch" href="/vue-storefront/assets/js/17.436bd902.js"><link rel="prefetch" href="/vue-storefront/assets/js/18.dfe351c0.js"><link rel="prefetch" href="/vue-storefront/assets/js/19.bed0ccef.js"><link rel="prefetch" href="/vue-storefront/assets/js/2.50660496.js"><link rel="prefetch" href="/vue-storefront/assets/js/20.3fe00257.js"><link rel="prefetch" href="/vue-storefront/assets/js/21.8d7f8005.js"><link rel="prefetch" href="/vue-storefront/assets/js/22.c8fda47e.js"><link rel="prefetch" href="/vue-storefront/assets/js/23.f8901ef6.js"><link rel="prefetch" href="/vue-storefront/assets/js/24.da9a41fa.js"><link rel="prefetch" href="/vue-storefront/assets/js/25.4da0ee27.js"><link rel="prefetch" href="/vue-storefront/assets/js/26.db4d7bc5.js"><link rel="prefetch" href="/vue-storefront/assets/js/27.0cdfd376.js"><link rel="prefetch" href="/vue-storefront/assets/js/28.9bf39ea4.js"><link rel="prefetch" href="/vue-storefront/assets/js/29.a582b203.js"><link rel="prefetch" href="/vue-storefront/assets/js/3.4b0d9954.js"><link rel="prefetch" href="/vue-storefront/assets/js/30.da006d9a.js"><link rel="prefetch" href="/vue-storefront/assets/js/31.bb84f19d.js"><link rel="prefetch" href="/vue-storefront/assets/js/32.48f70fb5.js"><link rel="prefetch" href="/vue-storefront/assets/js/33.42f48660.js"><link rel="prefetch" href="/vue-storefront/assets/js/34.892472a6.js"><link rel="prefetch" href="/vue-storefront/assets/js/35.f721fa58.js"><link rel="prefetch" href="/vue-storefront/assets/js/36.f1ed6236.js"><link rel="prefetch" href="/vue-storefront/assets/js/37.966aa529.js"><link rel="prefetch" href="/vue-storefront/assets/js/38.6849fe0a.js"><link rel="prefetch" href="/vue-storefront/assets/js/39.0a143604.js"><link rel="prefetch" href="/vue-storefront/assets/js/4.da95283c.js"><link rel="prefetch" href="/vue-storefront/assets/js/40.1485065c.js"><link rel="prefetch" href="/vue-storefront/assets/js/41.7d0abb94.js"><link rel="prefetch" href="/vue-storefront/assets/js/42.17511209.js"><link rel="prefetch" href="/vue-storefront/assets/js/43.3a890629.js"><link rel="prefetch" href="/vue-storefront/assets/js/45.0b8abd12.js"><link rel="prefetch" href="/vue-storefront/assets/js/46.ed0bc94f.js"><link rel="prefetch" href="/vue-storefront/assets/js/47.594a997d.js"><link rel="prefetch" href="/vue-storefront/assets/js/48.1d9f1863.js"><link rel="prefetch" href="/vue-storefront/assets/js/49.e1cd863c.js"><link rel="prefetch" href="/vue-storefront/assets/js/5.16e6c645.js"><link rel="prefetch" href="/vue-storefront/assets/js/50.3539db71.js"><link rel="prefetch" href="/vue-storefront/assets/js/51.41d40a26.js"><link rel="prefetch" href="/vue-storefront/assets/js/52.66e4c1d4.js"><link rel="prefetch" href="/vue-storefront/assets/js/53.6dd17bef.js"><link rel="prefetch" href="/vue-storefront/assets/js/54.9df050c8.js"><link rel="prefetch" href="/vue-storefront/assets/js/55.7252d9f7.js"><link rel="prefetch" href="/vue-storefront/assets/js/56.3426d656.js"><link rel="prefetch" href="/vue-storefront/assets/js/57.c7b8c269.js"><link rel="prefetch" href="/vue-storefront/assets/js/58.0e702986.js"><link rel="prefetch" href="/vue-storefront/assets/js/59.91bbe140.js"><link rel="prefetch" href="/vue-storefront/assets/js/6.4aea3919.js"><link rel="prefetch" href="/vue-storefront/assets/js/60.38d6087d.js"><link rel="prefetch" href="/vue-storefront/assets/js/61.93a11efe.js"><link rel="prefetch" href="/vue-storefront/assets/js/62.c70d760d.js"><link rel="prefetch" href="/vue-storefront/assets/js/63.58531f78.js"><link rel="prefetch" href="/vue-storefront/assets/js/7.9db11a60.js"><link rel="prefetch" href="/vue-storefront/assets/js/8.7ccc5f92.js"><link rel="prefetch" href="/vue-storefront/assets/js/9.b13b1e26.js">
    <link rel="stylesheet" href="/vue-storefront/assets/css/0.styles.6ab44ad9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vue-storefront/" class="home-link router-link-active"><!----> <span class="site-name">Vue Storefront</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://www.youtube.com/channel/UCkm1F3Cglty3CE1QwKQUhhg" target="_blank" rel="noopener noreferrer" class="nav-link external">
  YouTube
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://medium.com/the-vue-storefront-journal" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Medium
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/DivanteLtd/vue-storefront" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://www.youtube.com/channel/UCkm1F3Cglty3CE1QwKQUhhg" target="_blank" rel="noopener noreferrer" class="nav-link external">
  YouTube
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://medium.com/the-vue-storefront-journal" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Medium
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/DivanteLtd/vue-storefront" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/vue-storefront/guide/" class="sidebar-link">About</a></li><li><a href="/vue-storefront/guide/upgrade-notes/" class="sidebar-link">Upgrade notes</a></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Installation</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/vue-storefront/guide/installation/linux-mac.html" class="sidebar-link">Installing on Linux/MacOS</a></li><li><a href="/vue-storefront/guide/installation/windows.html" class="sidebar-link">Installing on Windows</a></li><li><a href="/vue-storefront/guide/installation/magento.html" class="sidebar-link">Integration with Magento 2</a></li><li><a href="/vue-storefront/guide/installation/production-setup.html" class="sidebar-link">Production setup</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Basics</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/vue-storefront/guide/basics/project-structure.html" class="sidebar-link">Project structure</a></li><li><a href="/vue-storefront/guide/basics/configuration.html" class="sidebar-link">Configuration file explained</a></li><li><a href="/vue-storefront/guide/basics/contributing.html" class="sidebar-link">How to Contribute</a></li><li><a href="/vue-storefront/guide/basics/feature-list.html" class="sidebar-link">Feature list</a></li><li><a href="/vue-storefront/guide/basics/recipes.html" class="sidebar-link">FAQ and Recipes</a></li><li><a href="/vue-storefront/guide/basics/typescript.html" class="sidebar-link">TypeScript Action Plan</a></li><li><a href="/vue-storefront/guide/basics/graphql.html" class="sidebar-link">GraphQL Action Plan</a></li><li><a href="/vue-storefront/guide/basics/ssr-cache.html" class="sidebar-link">SSR Cache</a></li><li><a href="/vue-storefront/guide/basics/amp.html" class="sidebar-link">Google Advanced Mobile Pages</a></li><li><a href="/vue-storefront/guide/basics/e2e.html" class="sidebar-link">E2E tests</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Core and themes</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/vue-storefront/guide/core-themes/themes.html" class="sidebar-link">Themes in Vue Storefront</a></li><li><a href="/vue-storefront/guide/core-themes/layouts.html" class="sidebar-link">Layouts and advanced output operations</a></li><li><a href="/vue-storefront/guide/core-themes/core-components.html" class="sidebar-link">Working with core components</a></li><li><a href="/vue-storefront/guide/core-themes/ui-store.html" class="sidebar-link">Working with UI Store (Interface state)</a></li><li><a href="/vue-storefront/guide/core-themes/translations.html" class="sidebar-link">Internationalization (i18n) of Vue Storefront</a></li><li><a href="/vue-storefront/guide/core-themes/service-workers.html" class="sidebar-link">Working with Service Workers</a></li><li><a href="/vue-storefront/guide/core-themes/webpack.html" class="sidebar-link">Working with Webpack</a></li><li><a href="/vue-storefront/guide/core-themes/plugins.html" class="sidebar-link">Working with plugins</a></li><li><a href="/vue-storefront/guide/core-themes/stylesheets.html" class="sidebar-link">Working with stylesheets in 'default' theme</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Components</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/vue-storefront/guide/components/home-page.html" class="sidebar-link">Core Home Page</a></li><li><a href="/vue-storefront/guide/components/category-page.html" class="sidebar-link">Core Category Page</a></li><li><a href="/vue-storefront/guide/components/product.html" class="sidebar-link">Core Product Page</a></li><li><a href="/vue-storefront/guide/components/modal.html" class="sidebar-link">Modal component</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Data in Vue Storefront</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/vue-storefront/guide/data/data.html" class="sidebar-link">Working with data</a></li><li><a href="/vue-storefront/guide/data/elasticsearch.html" class="sidebar-link">ElasticSearch data formats</a></li><li><a href="/vue-storefront/guide/data/data-migrations.html" class="sidebar-link">Data Migrations for ElacticSearch</a></li><li><a href="/vue-storefront/guide/data/elastic-queries.html" class="sidebar-link">ElasticSearch Queries</a></li><li><a href="/vue-storefront/guide/data/database-tool.html" class="sidebar-link">Database tool</a></li><li><a href="/vue-storefront/guide/data/entity-types.html" class="sidebar-link">Data Entity Types</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Extensions</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/vue-storefront/guide/extensions/extending-api.html" class="sidebar-link">Extending the API</a></li><li><a href="/vue-storefront/guide/extensions/extending-server-side-routes.html" class="sidebar-link">Extending Express.js server side routes</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Working with Vuex</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/vue-storefront/guide/vuex/introduction.html" class="sidebar-link">Introduction</a></li><li><a href="/vue-storefront/guide/vuex/product-store.html" class="sidebar-link">Product Vuex Store</a></li><li><a href="/vue-storefront/guide/vuex/category-store.html" class="sidebar-link">Category Vuex Store</a></li><li><a href="/vue-storefront/guide/vuex/cart-store.html" class="sidebar-link">Cart Vuex Store</a></li><li><a href="/vue-storefront/guide/vuex/checkout-store.html" class="sidebar-link">Checkout Vuex Store</a></li><li><a href="/vue-storefront/guide/vuex/order-store.html" class="sidebar-link">Order Vuex Store</a></li><li><a href="/vue-storefront/guide/vuex/stock-store.html" class="sidebar-link">Stock Vuex Store</a></li><li><a href="/vue-storefront/guide/vuex/user-store.html" class="sidebar-link">User Vuex Store</a></li><li><a href="/vue-storefront/guide/vuex/attribute-store.html" class="sidebar-link">Attribute Vuex Store</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Modules</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/vue-storefront/guide/modules/introduction.html" class="sidebar-link">Table of contents</a></li><li><a href="/vue-storefront/guide/modules/cart.html" class="sidebar-link">Cart module</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>Integrations</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/vue-storefront/guide/integrations/integrations.html" class="sidebar-link">Existing integrations</a></li><li><a href="/vue-storefront/guide/integrations/reviews.html" class="sidebar-link">Product Reviews</a></li><li><a href="/vue-storefront/guide/integrations/payment-gateway.html" class="active sidebar-link">Payment Gateway Integration</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vue-storefront/guide/integrations/payment-gateway.html#frontend-integration" class="sidebar-link">Frontend integration</a></li><li class="sidebar-sub-header"><a href="/vue-storefront/guide/integrations/payment-gateway.html#backend-integration" class="sidebar-link">Backend Integration</a></li></ul></li><li><a href="/vue-storefront/guide/integrations/paypal-payments.html" class="sidebar-link">PayPal payments support</a></li><li><a href="/vue-storefront/guide/integrations/direct-prices-sync.html" class="sidebar-link">Direct prices sync with Magento</a></li><li><a href="/vue-storefront/guide/integrations/tier-prices-sync.html" class="sidebar-link">Tier prices sync with Magento</a></li><li><a href="/vue-storefront/guide/integrations/totals-sync.html" class="sidebar-link">Totals and cart sync with Magento</a></li><li><a href="/vue-storefront/guide/integrations/multistore.html" class="sidebar-link">Multistore Magento2 support</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="payment-gateway-integration"><a href="#payment-gateway-integration" aria-hidden="true" class="header-anchor">#</a> Payment Gateway Integration</h1> <p>Vue Storefront is platform-agnostic app. That means it can be connected to virtually any eCommerce backend. By the same time, most of the existing eCommerce platforms integrates the Payment Gateways (PG) using some kind of frontend hooks:</p> <ul><li>some gateways are integrated by iframe component,</li> <li>others are injected by JavaScript snippet etc.</li></ul> <p>In this situation it's a rare case when You can modify Your payment gateway with PWA - without creating the integration code by yourself.</p> <h2 id="frontend-integration"><a href="#frontend-integration" aria-hidden="true" class="header-anchor">#</a> Frontend integration</h2> <p>First step is to create a Vue Storefront Extension to integrate the payment extension in the frontend. Any of the payment handling logic, UI is handled solely via the Extension. For the most basic version of how a Payment Extension is the &quot;src/extensions/cash-on-delivery&quot;.</p> <ul><li>The Payment Extension where applicable should catch the 'checkout-payment-method-changed' event, if the payment method code is the desired one, then you have the option to dynamically inject any components into the order review section on the checkout, (for example credit card input fields, payment method information etc).</li> <li>You are required to catch the 'checkout-before-placeOrder' event and do any processing required for the payment method before placing the order.</li> <li>You are required to emit the 'checkout-do-placeOrder' event with an optional payload to complete the placeorder process.</li> <li>For your payment method to display, add it to the Payment Methods collection in storage. 'app.$store.state.payment.methods.push(paymentMethodConfig)'</li> <li>Unregister any events when they are no longer required.</li> <li>For clarity in growing extensions, payment extensions should be named clearly 'payment-{VENDOR}-{PAYMENT_METHOD}'</li></ul> <h3 id="cash-on-delivery-example"><a href="#cash-on-delivery-example" aria-hidden="true" class="header-anchor">#</a> Cash on delivery example</h3> <p>Here is an example of &quot;Cash on delivery&quot; payment method:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> EventBus <span class="token keyword">from</span> <span class="token string">'@vue-storefront/core/plugins/event-bus'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> extensionStore <span class="token keyword">from</span> <span class="token string">'./store'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> extensionRoutes <span class="token keyword">from</span> <span class="token string">'./router'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> InfoComponent <span class="token keyword">from</span> <span class="token string">'./components/info'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">EXTENSION_KEY</span> <span class="token operator">=</span> <span class="token string">'payment-cash-on-delivery'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> router<span class="token punctuation">,</span> store<span class="token punctuation">,</span> config<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  router<span class="token punctuation">.</span><span class="token function">addRoutes</span><span class="token punctuation">(</span>extensionRoutes<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// add custom routes</span>
  store<span class="token punctuation">.</span><span class="token function">registerModule</span><span class="token punctuation">(</span><span class="token constant">EXTENSION_KEY</span><span class="token punctuation">,</span> extensionStore<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// add custom store</span>

  app<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'application-after-init'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token constant">EXTENSION_KEY</span> <span class="token operator">+</span> <span class="token string">' extension initialised'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Add this payment method to the config.</span>
  <span class="token keyword">let</span> paymentMethodConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
    title<span class="token punctuation">:</span> <span class="token string">'Cash on delivery'</span><span class="token punctuation">,</span>
    code<span class="token punctuation">:</span> <span class="token string">'cashondelivery'</span><span class="token punctuation">,</span>
    cost<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    costInclTax<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    offline<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  app<span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'payment/addMethod'</span><span class="token punctuation">,</span> paymentMethodConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Mount the info component when required.</span>
  EventBus<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'checkout-payment-method-changed'</span><span class="token punctuation">,</span> paymentMethodCode <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>paymentMethodCode <span class="token operator">===</span> <span class="token string">'cashondelivery'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Register the handler for what happens when they click the place order button.</span>
      EventBus<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'checkout-before-placeOrder'</span><span class="token punctuation">,</span> placeOrder<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// Dynamically inject a component into the order review section (optional)</span>
      <span class="token keyword">const</span> Component <span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span>InfoComponent<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> componentInstance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Component</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// here it is the special slot for adding payment gateway information to the Order Review page</span>
      componentInstance<span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#checkout-order-review-additional'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// unregister the extensions placeorder handler</span>
      EventBus<span class="token punctuation">.</span><span class="token function">$off</span><span class="token punctuation">(</span><span class="token string">'checkout-before-placeOrder'</span><span class="token punctuation">,</span> placeOrder<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token constant">EXTENSION_KEY</span><span class="token punctuation">,</span> extensionRoutes<span class="token punctuation">,</span> extensionStore <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Place the order. Payload is empty as we don't have any specific info to add for this payment method '{}'</span>
<span class="token keyword">function</span> <span class="token function">placeOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  EventBus<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'checkout-do-placeOrder'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="more-examples"><a href="#more-examples" aria-hidden="true" class="header-anchor">#</a> More examples</h3> <p>You can find much more sophisticated solutions for <a href="https://github.com/develodesign/vsf-payment-paypal" target="_blank" rel="noopener noreferrer">Paypal<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> and <a href="https://github.com/develodesign/vsf-payment-stripe" target="_blank" rel="noopener noreferrer">Stripe<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> on our partner - <strong>Develodesign</strong> github</p> <p>Looking at the Stripe integration You may seen that the main extension code looks more or less the same as Cash on Delivery - simply injecting additional information (custom component) to the Order Review page:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> extensionStore <span class="token keyword">from</span> <span class="token string">'./lib/store'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> extensionRoutes <span class="token keyword">from</span> <span class="token string">'./lib/router'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> StripeComponent <span class="token keyword">from</span> <span class="token string">'./lib/components/PaymentStripe'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> EventBus <span class="token keyword">from</span> <span class="token string">'core/plugins/event-bus'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">EXTENSION_KEY</span> <span class="token operator">=</span> <span class="token string">'vsf-payment-stripe'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> router<span class="token punctuation">,</span> store<span class="token punctuation">,</span> config<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  router<span class="token punctuation">.</span><span class="token function">addRoutes</span><span class="token punctuation">(</span>extensionRoutes<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// add custom routes</span>
  store<span class="token punctuation">.</span><span class="token function">registerModule</span><span class="token punctuation">(</span><span class="token constant">EXTENSION_KEY</span><span class="token punctuation">,</span> extensionStore<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// add custom store</span>

  app<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'application-after-init'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">EXTENSION_KEY</span> <span class="token operator">+</span> <span class="token string">' extension initialised'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Add this payment method to the config.</span>
  <span class="token keyword">let</span> paymentMethodConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'Stripe'</span><span class="token punctuation">,</span>
    code<span class="token punctuation">:</span> <span class="token string">'stripe'</span><span class="token punctuation">,</span>
    cost<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    costInclTax<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    offline<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  app<span class="token punctuation">.</span>$store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>payment<span class="token punctuation">.</span>methods<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>paymentMethodConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Mount the stripe component when required.</span>
  EventBus<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'checkout-payment-method-changed'</span><span class="token punctuation">,</span> paymentMethodCode <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>paymentMethodCode <span class="token operator">===</span> <span class="token string">'stripe'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> Component <span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span>StripeComponent<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> componentInstance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Component</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      componentInstance<span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#checkout-order-review-additional'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token constant">EXTENSION_KEY</span><span class="token punctuation">,</span> extensionRoutes<span class="token punctuation">,</span> extensionStore <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The core of this integration, however, may be found in the <code>lib/components/PaymentStripe.vue</code> where the Stripe specific scripts are imported and included:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>

  <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;mb15 mt20 vsf-stripe-container&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>h4 <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;mt0&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>label <span class="token keyword">for</span><span class="token operator">=</span><span class="token string">&quot;vsf-stripe-card-element&quot;</span><span class="token operator">&gt;</span>
        Credit or debit card
      <span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>h4<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;bg-cl-secondary px20 py20&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>form action<span class="token operator">=</span><span class="token string">&quot;&quot;</span> id<span class="token operator">=</span><span class="token string">&quot;payment-form&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;form-row&quot;</span><span class="token operator">&gt;</span>

          <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;vsf-stripe-card-element&quot;</span><span class="token operator">&gt;</span>
            <span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span>
            <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> <span class="token constant">A</span> Stripe Element will be inserted here<span class="token punctuation">.</span> <span class="token operator">--</span><span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>

          <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> Used to display Element errors<span class="token punctuation">.</span> <span class="token operator">--</span><span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;vsf-stripe-card-errors&quot;</span> role<span class="token operator">=</span><span class="token string">&quot;alert&quot;</span><span class="token operator">&gt;</span>
            <span class="token operator">&amp;</span>nbsp<span class="token punctuation">;</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>style scoped<span class="token operator">&gt;</span>
  <span class="token comment">/* Base styling for the component. */</span>

  <span class="token punctuation">.</span>vsf<span class="token operator">-</span>stripe<span class="token operator">-</span>container label <span class="token punctuation">{</span>
    font<span class="token operator">-</span>weight<span class="token punctuation">:</span> <span class="token number">500</span><span class="token punctuation">;</span>
    font<span class="token operator">-</span>size<span class="token punctuation">:</span> <span class="token number">14</span>px<span class="token punctuation">;</span>
    display<span class="token punctuation">:</span> block<span class="token punctuation">;</span>
    margin<span class="token operator">-</span>bottom<span class="token punctuation">:</span> <span class="token number">8</span>px<span class="token punctuation">;</span>
    color<span class="token punctuation">:</span> #<span class="token number">818992</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  #vsf<span class="token operator">-</span>stripe<span class="token operator">-</span>card<span class="token operator">-</span>errors <span class="token punctuation">{</span>
    margin<span class="token punctuation">:</span> <span class="token number">8</span>px auto <span class="token number">0</span><span class="token punctuation">;</span>
    color<span class="token punctuation">:</span> #fa755a<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token punctuation">.</span>vsf<span class="token operator">-</span>stripe<span class="token operator">-</span>container <span class="token punctuation">.</span>StripeElement <span class="token punctuation">{</span>
    background<span class="token operator">-</span>color<span class="token punctuation">:</span> white<span class="token punctuation">;</span>
    padding<span class="token punctuation">:</span> <span class="token number">10</span>px <span class="token number">12</span>px<span class="token punctuation">;</span>
    border<span class="token operator">-</span>radius<span class="token punctuation">:</span> <span class="token number">4</span>px<span class="token punctuation">;</span>
    border<span class="token punctuation">:</span> <span class="token number">1</span>px solid transparent<span class="token punctuation">;</span>
    box<span class="token operator">-</span>shadow<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token number">1</span>px <span class="token number">3</span>px <span class="token number">0</span> #e6ebf1<span class="token punctuation">;</span>
    <span class="token operator">-</span>webkit<span class="token operator">-</span>transition<span class="token punctuation">:</span> box<span class="token operator">-</span>shadow <span class="token number">150</span>ms ease<span class="token punctuation">;</span>
    transition<span class="token punctuation">:</span> box<span class="token operator">-</span>shadow <span class="token number">150</span>ms ease<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token punctuation">.</span>vsf<span class="token operator">-</span>stripe<span class="token operator">-</span>container <span class="token punctuation">.</span>StripeElement<span class="token operator">--</span>focus <span class="token punctuation">{</span>
    box<span class="token operator">-</span>shadow<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token number">1</span>px <span class="token number">3</span>px <span class="token number">0</span> #cfd7df<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token punctuation">.</span>vsf<span class="token operator">-</span>stripe<span class="token operator">-</span>container <span class="token punctuation">.</span>StripeElement<span class="token operator">--</span>invalid <span class="token punctuation">{</span>
    border<span class="token operator">-</span>color<span class="token punctuation">:</span> #fa755a<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token punctuation">.</span>vsf<span class="token operator">-</span>stripe<span class="token operator">-</span>container <span class="token punctuation">.</span>StripeElement<span class="token operator">--</span>webkit<span class="token operator">-</span>autofill <span class="token punctuation">{</span>
    background<span class="token operator">-</span>color<span class="token punctuation">:</span> #fefde5 <span class="token operator">!</span>important<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">import</span> i18n <span class="token keyword">from</span> <span class="token string">'core/lib/i18n'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'PaymentStripe'</span><span class="token punctuation">,</span>
  <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      dd_stripe<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        instance<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
        elements<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
        card<span class="token punctuation">:</span> <span class="token keyword">null</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">mounted</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Load the stripe.js elements script.</span>
    <span class="token comment">// As it's callback, Configure stripe to run.</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">loadStripeDependencies</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>configureStripe<span class="token punctuation">)</span>

    <span class="token comment">// Ready to place order, handle anything we need to, generating, validating stripe requests &amp; tokens ect.</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$bus<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'checkout-before-placeOrder'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>onBeforePlaceOrder<span class="token punctuation">)</span>

    <span class="token comment">// Ready to place order, handle anything we need to, generating, validating stripe requests &amp; tokens ect.</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$bus<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'checkout-payment-method-changed'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>paymentMethodCode<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>paymentMethodCode <span class="token operator">!==</span> <span class="token string">'stripe'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// unregister the extension placeorder handler</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$bus<span class="token punctuation">.</span><span class="token function">$off</span><span class="token punctuation">(</span><span class="token string">'checkout-before-placeOrder'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>onBeforePlaceOrder<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">onBeforePlaceOrder</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">processStripeForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">loadStripeDependencies</span> <span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> stripeJsUrl <span class="token operator">=</span> <span class="token string">'https://js.stripe.com/v3/'</span>

      <span class="token keyword">let</span> docHead <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'head'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
      <span class="token keyword">let</span> docScript <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span>

      docScript<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'text/javascript'</span>
      docScript<span class="token punctuation">.</span>src <span class="token operator">=</span> stripeJsUrl

      <span class="token comment">// When script is ready fire our callback.</span>
      docScript<span class="token punctuation">.</span>onreadystatechange <span class="token operator">=</span> callback
      docScript<span class="token punctuation">.</span>onload <span class="token operator">=</span> callback

      docHead<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>docScript<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">configureStripe</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Create a new Stripe client.</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$config<span class="token punctuation">.</span>stripe<span class="token punctuation">.</span>api_key <span class="token operator">===</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">this</span><span class="token punctuation">.</span>dd_stripe<span class="token punctuation">.</span>instance <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">Stripe</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$config<span class="token punctuation">.</span>stripe<span class="token punctuation">.</span>api_key<span class="token punctuation">)</span>

      <span class="token comment">// Create an instance of Elements.</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>dd_stripe<span class="token punctuation">.</span>elements <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dd_stripe<span class="token punctuation">.</span>instance<span class="token punctuation">.</span><span class="token function">elements</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

      <span class="token comment">// Create the stripe elements card</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

      <span class="token comment">// Add the event listeners for stripe.</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">bindEventListeners</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">createElements</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> style <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$config<span class="token punctuation">.</span>stripe<span class="token punctuation">.</span>style <span class="token operator">!==</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        style <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$config<span class="token punctuation">.</span>stripe<span class="token punctuation">.</span>style
      <span class="token punctuation">}</span>

      <span class="token comment">// Create an instance of the card Element.</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>dd_stripe<span class="token punctuation">.</span>card <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dd_stripe<span class="token punctuation">.</span>elements<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">'card'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> style<span class="token punctuation">:</span> style <span class="token punctuation">}</span><span class="token punctuation">)</span>

      <span class="token comment">// Add an instance of the card Element into the `card-element` &lt;div&gt;.</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>dd_stripe<span class="token punctuation">.</span>card<span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">'#vsf-stripe-card-element'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">bindEventListeners</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Handle real-time validation errors from the card Element.</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>dd_stripe<span class="token punctuation">.</span>card<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'change'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>onStripeCardChange<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">onStripeCardChange</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> displayError <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'vsf-stripe-card-errors'</span><span class="token punctuation">)</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        displayError<span class="token punctuation">.</span>textContent <span class="token operator">=</span> event<span class="token punctuation">.</span>error<span class="token punctuation">.</span>message
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        displayError<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">''</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">beforeDestroy</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">unbindEventListeners</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">unbindEventListeners</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>dd_stripe<span class="token punctuation">.</span>card<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'change'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>onStripeCardChange<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">processStripeForm</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> ctx <span class="token operator">=</span> <span class="token keyword">this</span>

      <span class="token comment">// Display loader</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$bus<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'notification-progress-start'</span><span class="token punctuation">,</span> i18n<span class="token punctuation">.</span><span class="token function">t</span><span class="token punctuation">(</span><span class="token string">'Placing Order'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'...'</span><span class="token punctuation">)</span>

      <span class="token comment">// Generate token from stripe</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>dd_stripe<span class="token punctuation">.</span>instance<span class="token punctuation">.</span><span class="token function">createToken</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>dd_stripe<span class="token punctuation">.</span>card<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// Inform the user if there was an error.</span>
          <span class="token keyword">let</span> errorElement <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'vsf-stripe-card-errors'</span><span class="token punctuation">)</span>

          errorElement<span class="token punctuation">.</span>textContent <span class="token operator">=</span> result<span class="token punctuation">.</span>error<span class="token punctuation">.</span>message
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          ctx<span class="token punctuation">.</span><span class="token function">placeOrderWithPayload</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>token<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        ctx<span class="token punctuation">.</span>$bus<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'notification-progress-stop'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">placeOrderWithPayload</span> <span class="token punctuation">(</span>payload<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$bus<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'checkout-do-placeOrder'</span><span class="token punctuation">,</span> payload<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  components<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><h2 id="backend-integration"><a href="#backend-integration" aria-hidden="true" class="header-anchor">#</a> Backend Integration</h2> <p>After successfully integrating the payments on the frontend you're sending the users and transactions to the payment integrator. Then we need to get back the payment token/identifier and update the order status as soon as the payment integrator will let us know that the transaction finished.</p> <p>To store the transaction info you'll get from the payment service you may emit an event:</p> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token function">placeOrderWithPayload</span> <span class="token punctuation">(</span>payload<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$bus<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'checkout-do-placeOrder'</span><span class="token punctuation">,</span> payload<span class="token punctuation">)</span>
</code></pre></div><p>Where the payload equals to JSON object with additional order information.
This object will be transferred to the server along with the order object in the <code>order.payment_method_additional</code> property.</p> <h3 id="the-order-workflow-server-side"><a href="#the-order-workflow-server-side" aria-hidden="true" class="header-anchor">#</a> The order workflow - server side</h3> <p>To get it right, first we must understand how Vue Storefront processes orders.
Vue Storefront sends orders to the server asynchronously because of the offline orders support (order can be send immediately after placed, minutes after or even hours).</p> <p>The order is being send to <code>vue-storefront-api/api/order/create</code> endpoint. This API endpoint pushes the order to the queue from where it's being transferred to the eCommerce backend by cron-run process called <code>order_2_magento2.js</code> (o2m). You may find the source code of <code>o2m</code> in the <code>vue-storefront-api/worker</code> folder.</p> <p>As You see we don't have the backend's order number immediately after order has been placed. To pair the client side order id and server side meta data <code>order_2_magento.js</code> process stores special metadata entries in <code>Redis</code> cache:</p> <div class="language-js extra-class"><pre class="language-js"><code>api<span class="token punctuation">.</span>cart<span class="token punctuation">.</span><span class="token function">order</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> cartId<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;paymentMethod&quot;</span><span class="token punctuation">:</span>
  <span class="token punctuation">{</span>
      <span class="token string">&quot;method&quot;</span><span class="token punctuation">:</span>orderData<span class="token punctuation">.</span>addressInformation<span class="token punctuation">.</span>payment_method_code<span class="token punctuation">,</span>
      <span class="token string">&quot;additional_data&quot;</span><span class="token punctuation">:</span>orderData<span class="token punctuation">.</span>addressInformation<span class="token punctuation">.</span>payment_method_additional
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> isThisAuthOrder<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>result <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token constant">THREAD_ID</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>job<span class="token punctuation">)</span> job<span class="token punctuation">.</span><span class="token function">progress</span><span class="token punctuation">(</span>currentStep<span class="token operator">++</span><span class="token punctuation">,</span> <span class="token constant">TOTAL_STEPS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token constant">THREAD_ID</span> <span class="token operator">+</span> <span class="token string">'[OK] Order placed with ORDER ID'</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
  logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token constant">THREAD_ID</span> <span class="token operator">+</span> result<span class="token punctuation">)</span>
  redisClient<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&quot;order$$id$$&quot;</span> <span class="token operator">+</span> orderData<span class="token punctuation">.</span>order_id<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span>
      platform_order_id<span class="token punctuation">:</span> result<span class="token punctuation">,</span>
      transmited<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      transmited_at<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      platform<span class="token punctuation">:</span> <span class="token string">'magento2'</span><span class="token punctuation">,</span>
      order<span class="token punctuation">:</span> orderData
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  redisClient<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&quot;order$$totals$$&quot;</span> <span class="token operator">+</span> orderData<span class="token punctuation">.</span>order_id<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span><span class="token punctuation">(</span>job<span class="token punctuation">)</span> job<span class="token punctuation">.</span><span class="token function">progress</span><span class="token punctuation">(</span>currentStep<span class="token operator">++</span><span class="token punctuation">,</span> <span class="token constant">TOTAL_STEPS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> magentoOrderId<span class="token punctuation">:</span> result<span class="token punctuation">,</span> transferedAt<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>As You may see - You can get the order data using <strong>client side</strong> order id by accesing the <code>order$$id$${clientsideorderid}</code> in local Redis instance.</p> <p>You may check <code>vue-storefront-api/src/api/sync.js</code> the <code>check</code> method:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> config<span class="token punctuation">,</span> db <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> syncApi <span class="token operator">=</span> <span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/**
   * GET get stock item
   */</span>
  syncApi<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/order/:order_id'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> Redis <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'redis'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> redisClient <span class="token operator">=</span> Redis<span class="token punctuation">.</span><span class="token function">createClient</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>redis<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// redis client</span>
    redisClient<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// workaround for https://github.com/NodeRedis/node_redis/issues/713</span>
      redisClient <span class="token operator">=</span> Redis<span class="token punctuation">.</span><span class="token function">createClient</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>redis<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// redis client</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    redisClient<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'order$$id$$'</span> <span class="token operator">+</span> req<span class="token punctuation">.</span><span class="token function">param</span><span class="token punctuation">(</span><span class="token string">'order_id'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>
      err<span class="token punctuation">,</span>
      reply<span class="token punctuation">,</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> orderMetaData <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>reply<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>orderMetaData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        orderMetaData<span class="token punctuation">.</span>order <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// for security reasons we're just clearing out the real order data as it's set by `order_2_magento2.js`</span>
      <span class="token punctuation">}</span>
      <span class="token function">apiStatus</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> err <span class="token operator">?</span> err <span class="token punctuation">:</span> orderMetaData<span class="token punctuation">,</span> err <span class="token operator">?</span> <span class="token number">500</span> <span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> syncApi<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>As this method returns the order data by non-secured URL with just client side order id - there is <code>order</code> property being removed to return just the platform id of their order.</p> <h3 id="status-change-for-the-order"><a href="#status-change-for-the-order" aria-hidden="true" class="header-anchor">#</a> Status change for the order</h3> <p>The example shown above was a prep. step for updating the Magento (or other platform) order status based on the response from the payments integrator.</p> <p>First of all - You need to add the special endpoint under public URL which will be getting the notifications / statuses from the payments provider. Here is an example [how to add custom API endpoint to the <code>vue-storefront-api</code>](Extending vue-storefront-api.md).</p> <p>To add the API extension to <code>vue-storefront-api</code>:</p> <ol><li>Create the folder within <code>src/api/extensions</code> for example 'custom-payment-method`</li> <li>Then add the <code>index.js</code> file and put the API methods code inside. We're using Express.js. Here is a boilerplate/example for the extension code:</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> apiStatus <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../../../lib/util'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Router <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'express'</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> config<span class="token punctuation">,</span> db <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> mcApi <span class="token operator">=</span> <span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/**
   * POST create an user
   */</span>
  mcApi<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/status'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> notificationData <span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
    <span class="token keyword">const</span> order_id <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span> <span class="token comment">// we should extract the client's order id from the notification status</span>
    <span class="token comment">/// ... business logic related to the status verification</span>

    <span class="token comment">// getting the data from Redis - the original order</span>
    <span class="token keyword">const</span> Redis <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'redis'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> Magento2Client <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'magento2-rest-client'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Magento2Client<span class="token punctuation">;</span>

    <span class="token keyword">let</span> redisClient <span class="token operator">=</span> Redis<span class="token punctuation">.</span><span class="token function">createClient</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>redis<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// redis client</span>
    redisClient<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// workaround for https://github.com/NodeRedis/node_redis/issues/713</span>
      redisClient <span class="token operator">=</span> Redis<span class="token punctuation">.</span><span class="token function">createClient</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>redis<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// redis client</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    redisClient<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'order$$id$$'</span> <span class="token operator">+</span> order_id<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> reply<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> orderMetaData <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>reply<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>orderMetaData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// now we can use the api client to update the order status in Magento</span>
        <span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token function">Magento2Client</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>magento2<span class="token punctuation">.</span>api<span class="token punctuation">)</span><span class="token punctuation">;</span>
        client<span class="token punctuation">.</span><span class="token function">addMethods</span><span class="token punctuation">(</span><span class="token string">'invoice'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>restClient<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">var</span> module <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

          module<span class="token punctuation">.</span><span class="token function-variable function">create</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> restClient<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/invoice/create'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// the real Magento2 endpoint should be here - this is just an example</span>
          <span class="token punctuation">}</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> module<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        client<span class="token punctuation">.</span>invoice
          <span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>result <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">apiStatus</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> result<span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// just dump it to the browser, result = JSON object</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>err <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">apiStatus</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> err<span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> mcApi<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><ol start="3"><li>Add the extension to <code>config/local.json</code>:</li></ol> <div class="language-json extra-class"><pre class="language-json"><code>	<span class="token property">&quot;registeredExtensions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;custom-payment-method&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><ol start="4"><li>Restart the <code>vue-storefront-api</code></li> <li>Your new API method is available on <code>localhost:8080/api/ext/&lt;extension_name&gt;/&lt;extension_method&gt;</code> for example: <code>localhost:8080/api/ext/custom-payment-method/status</code></li></ol> <p>In this extension above You may want to get the order data by the client side order id (passed to the payment service and probably returned with the notification). Then <strong>You may use the Magento2 API to update the payment status</strong> - probably by executing the <code>invoice</code> method.</p></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/DivanteLtd/vue-storefront/edit/master/docs/guide/integrations/payment-gateway.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/vue-storefront/guide/integrations/reviews.html" class="prev">
          Product Reviews
        </a></span> <span class="next"><a href="/vue-storefront/guide/integrations/paypal-payments.html">
          PayPal payments support
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/vue-storefront/assets/js/44.5f33530b.js" defer></script><script src="/vue-storefront/assets/js/app.cd989924.js" defer></script>
  </body>
</html>
