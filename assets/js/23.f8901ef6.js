(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{194:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[t._m(0),t._v(" "),a("p",[t._v("We're using service workers for two main purposes:")]),t._v(" "),a("ol",[a("li",[t._v("To cache out static and dynamic data feeds - to make them "),a("a",{attrs:{href:"https://developers.google.com/web/fundamentals/primers/service-workers/",target:"_blank",rel:"noopener noreferrer"}},[t._v("available offline"),a("OutboundLink")],1)]),t._v(" "),a("li",[t._v("To run offline data sync using service workers")])]),t._v(" "),a("p",[t._v("To achieve the first point, we're using "),a("a",{attrs:{href:"https://github.com/GoogleChromeLabs/sw-precache",target:"_blank",rel:"noopener noreferrer"}},[t._v("sw-precache"),a("OutboundLink")],1),t._v(" from Google and for the second - Vanilla JS with a little help from "),a("a",{attrs:{href:"https://www.google.pl/search?q=sw-toolbox&oq=sw-toolbox&aqs=chrome..69i57j69i60l3j0l2.1529j0j4&sourceid=chrome&ie=UTF-8",target:"_blank",rel:"noopener noreferrer"}},[t._v("sw-toolbox"),a("OutboundLink")],1)]),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),t._m(4),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),t._m(7),t._v(" "),t._m(8),t._m(9),t._v(" "),t._m(10)])},[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"working-with-service-workers"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#working-with-service-workers","aria-hidden":"true"}},[this._v("#")]),this._v(" Working with Service Workers")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"making-things-happen"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#making-things-happen","aria-hidden":"true"}},[this._v("#")]),this._v(" Making things happen")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[t._v("The service-worker source code for "),a("code",[t._v("vue-storefront")]),t._v(" is pre-compiled with Babel presets and all is stored in additional theme-specific Service Worker in "),a("code",[t._v("src/{themename}/service-worker/index.js")]),t._v(". This file is attached to "),a("code",[t._v("service-worker.js")]),t._v(" generated by "),a("code",[t._v("sw-toolbox")]),t._v(".")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("After changing anything in "),s("code",[this._v("{themename}/service-worker/index.js")]),this._v(", despite you're in "),s("code",[this._v("yarn dev")]),this._v(" auto reloading mode, you need to do two things:")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",[s("li",[s("p",[this._v("Recompile app (which regenerates service-worker):\n"),s("code",[this._v("yarn build")])])]),this._v(" "),s("li",[s("p",[this._v("Reload Service worker in Dev Tools (in Chrome - just click "),s("strong",[this._v('"Unregister"')]),this._v(" and reload the page, new SW will be installed).")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:"/vue-storefront/chrome-dev-console.png",alt:"How to work with service-workers in Chrome"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"communication-with-the-app"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#communication-with-the-app","aria-hidden":"true"}},[this._v("#")]),this._v(" Communication with the app")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Application can speak to service worker using the event bus - and only doing so. Please take a look at "),s("code",[this._v("/core/lib/sw.js")]),this._v(" where we have following method:")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("postMessage")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("payload"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'serviceWorker'")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("in")]),t._v(" navigator "),a("span",{attrs:{class:"token operator"}},[t._v("&&")]),t._v(" navigator"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("serviceWorker"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("controller"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token comment"}},[t._v("// check if it's properly installed")]),t._v("\n    navigator"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("serviceWorker"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("controller"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("postMessage")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("payload"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("false")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token comment"}},[t._v("// no service workers supported push the queue manualy")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("true")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("It allows you to send data to service worker. For example, when the order is placed ("),s("code",[this._v("/core/store/modules/checkout")]),this._v("):")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("  "),a("span",{attrs:{class:"token comment"}},[t._v("/**\n   * Add order to sync. queue\n   * @param {Object} product data format for products is described in /doc/ElasticSearch data formats.md\n   */")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("types"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token constant"}},[t._v("CHECKOUT_PLACE_ORDER")]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("state"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" order"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ordersCollection "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" Vue"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$db"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ordersCollection\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" orderId "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" entities"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("uniqueEntityId")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("order"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token comment"}},[t._v("// timestamp as a order id is not the best we can do but it's enough")]),t._v("\n    order"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" orderId"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("toString")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    order"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("transmited "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n    order"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("created_at "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("Date")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    order"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("updated_at "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("Date")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    ordersCollection"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("setItem")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("orderId"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("toString")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" order"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("catch")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("reason"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      console"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("error")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("reason"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token comment"}},[t._v("// it doesn't work on SSR")]),t._v("\n      sw"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("postMessage")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" config"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" config"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" command"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" types"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token constant"}},[t._v("CHECKOUT_PROCESS_QUEUE")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token comment"}},[t._v("// process checkout queue")]),t._v("\n      console"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("info")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'Order placed, orderId = '")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("+")]),t._v(" orderId"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token comment"}},[t._v("// populate cache")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])])}],!1,null,null,null);e.options.__file="service-workers.md";s.default=e.exports}}]);